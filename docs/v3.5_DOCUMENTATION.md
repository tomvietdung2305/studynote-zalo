# StudyNote Project Documentation (v3.5)

This document serves as the central reference for the StudyNote application, consolidating setup, database design, deployment, and feature usage.

**Version:** 3.5
**Release Date:** November 25, 2025
**Key Updates:** Full Firestore Integration, Web Deployment Support, AI Reporting.

---

## 1. System Overview
StudyNote is a Zalo Mini App designed for teachers to manage classes, attendance, grades, and generate AI-powered student reports. It connects to a Node.js/Express backend and uses Firebase Firestore for data persistence.

### Tech Stack
- **Frontend:** React (Vite), ZMP SDK, ZMP UI, TailwindCSS.
- **Backend:** Node.js, Express.
- **Database:** Firebase Firestore (NoSQL).
- **AI:** OpenAI API (GPT-4o/GPT-3.5).
- **Deployment:** Vercel (Frontend & Backend).

---

## 2. Database Schema
The application uses a document-oriented database structure.

### Collections
- **`users`**: Teacher/Parent profiles.
- **`classes`**: Class details (`name`, `schedules`, `user_id`).
- **`students`**: Student profiles (`class_id`, `name`, `parent_zalo_id`, `connection_code`).
- **`attendance_records`**: Daily attendance logs (`class_id`, `date`, `data: { studentId: status }`).
- **`grades`**: Student scores (`class_id`, `student_id`, `score`, `comment`).
- **`reports`**: AI-generated reports (`student_id`, `ai_report`, `isSaved`).

*For full details, see `docs/schema_design.md`.*

---

## 3. Setup & Installation

### Prerequisites
- Node.js (v18+)
- Firebase Project (with Firestore enabled)
- OpenAI API Key

### Local Development
1.  **Clone Repository**:
    ```bash
    git clone <repo-url>
    cd studynote
    ```
2.  **Backend Setup**:
    - `cd server`
    - `npm install`
    - Create `.env` with `FIREBASE_...` and `OPENAI_API_KEY`.
    - Place `serviceAccountKey.json` in `server/` (optional if using Env Vars).
    - `npm run dev` (Runs on port 3001).
3.  **Frontend Setup**:
    - `cd ..` (Root)
    - `npm install`
    - `npm run dev` (Runs on port 3000).

---

## 4. Deployment Guide (Vercel)

### Backend (`studynote-server`)
- **Root Directory**: `server`
- **Env Vars**: Copy all from `server/.env`.
- **Output**: Returns a domain (e.g., `https://studynote-server.vercel.app`).

### Frontend (`studynote-web`)
- **Root Directory**: `.` (Root)
- **Framework**: Vite
- **Env Vars**:
    - `VITE_API_URL`: `https://studynote-server.vercel.app/api`
- **Output**: Web App URL.

*For detailed steps, see `deployment_guide.md`.*

---

## 5. Key Features & Usage

### 5.1. Class Management
- Create classes and add students.
- **Note**: Students are currently managed within the Class view.

### 5.2. Attendance
- Mark Present/Absent/Late.
- Data is saved instantly to Firestore.

### 5.3. AI Reports
- Select a student, input raw notes.
- Click "Tạo báo cáo AI".
- **Save**: Click "Lưu báo cáo" to persist to Firestore.
- **Status**: Look for "Đã lưu DB" indicator.

### 5.4. Web Mode
- The app supports running on a web browser for demo/testing.
- It simulates a mobile view frame.
- Use "Dev Login (Demo Mode)" to bypass Zalo authentication.

---

## 6. Troubleshooting

### Common Issues
- **`PERMISSION_DENIED`**: The Service Account lacks "Firebase Admin" role. Check Google Cloud IAM.
- **Data not saving**: Ensure `VITE_API_URL` is correct and Backend is running.
- **White screen on Web**: Check Console for errors. Ensure `LayoutWrapper` is handling `isWeb()` correctly.
